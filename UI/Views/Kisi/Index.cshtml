@model IEnumerable<KisiVM>

@{
    ViewData["Title"] = "Index";
}

<h1>Index</h1>

<p>
    <a asp-action="Create">Create New</a>
</p>

<div id="toolbar">
    <button id="delete" class="btn btn-danger">Sil</button>
</div>

<table id="table"
       data-toggle="table"
       data-show-columns="true"
       data-multiple-select-row="true"
       data-click-to-select="true"
       data-pagination="true"
       data-search="true"
       data-ajax="ajaxRequest" @*AJAX için kullanılacak olan Fonksiyon adı dır.*@
       data-url="https://localhost:44353/api/Kisi/GET"
       data-side-pagination="server"
       data-buttons="buttons">
    <thead>
        <tr>
            <th id="chk" data-field="state" data-checkbox="true"></th>
            <th data-sortable="true" data-field="ad">Ad</th>
            <th data-field="soyad">Soyad</th>
            <th data-field="yas">Yas</th>
        </tr>
    </thead>
    <tbody>
        <tr>
        </tr>
    </tbody>
</table>
<script>

    var tablo = $('#table');
    $('#delete').click(function () {
        var ids = $.map(tablo.bootstrapTable('getSelections'), function (row) {
            console.log(row.id);
            Delete(row.id);
            return row.id;
        });
        tablo.bootstrapTable('remove', {
            field: 'id',
            values: ids
        });      
    });


    function ajaxRequest(value) {
        var url = "https://localhost:44353/api/Kisi/GET";
        $.get(url + '?' + $.param(value.data)).then(function (result) {
            console.log(result.length);
            console.log(result);

            value.success(result);

        });
    };
    function Delete(id) {
        $.ajax({
            url: "https://localhost:44353/api/Kisi/Delete/" + id,
            type: 'DELETE',
            dataType: 'json',
            data: { id: id },
            contentType: 'application/json; charset=utf-8',
            success: function (result) {
                alert("Silme Başarılı!");
                window.location.href = 'https://localhost:44368/Kisi';
            },
            failure: function (err) {
                alert("Hata");
            }

        });
    };
</script>